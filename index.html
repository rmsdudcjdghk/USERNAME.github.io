<!doctype html>
const thumb = document.createElement('a');
thumb.href = `#/${p.slug}`;
thumb.className = 'thumb';
if (p.cover) thumb.style.backgroundImage = `linear-gradient(135deg, color-mix(in oklab, var(--accent) 15%, black), transparent), url('${p.cover}')`;
const body = document.createElement('div');
body.className = 'card-body';
body.innerHTML = `<h3><a href="#/${p.slug}">${p.title}</a></h3><p>${p.excerpt ?? ''}</p>`;
const meta = document.createElement('div');
meta.className = 'meta';
meta.innerHTML = `<span>${p.date}</span><span>${(p.tags||[]).join(' · ')}</span>`;
card.append(thumb, body, meta);
grid.appendChild(card);
});
}


function renderToc(container) {
const hs = container.querySelectorAll('h2, h3');
if (!hs.length) return (document.getElementById('toc').hidden = true);
const ul = document.createElement('ul');
hs.forEach(h => {
if (!h.id) h.id = h.textContent.trim().toLowerCase().replace(/\s+/g,'-');
const li = document.createElement('li');
li.style.listStyle = 'square inside';
li.innerHTML = `<a href="#${h.id}">${h.textContent}</a>`;
ul.appendChild(li);
});
const toc = document.getElementById('toc');
toc.innerHTML = '<strong>이 글의 목차</strong>';
toc.appendChild(ul);
toc.hidden = false;
}


function renderPost(slug) {
const p = posts.find(x => x.slug === slug);
if (!p) { location.hash = '#/'; return; }
grid.parentElement.hidden = true;
view.hidden = false;
document.getElementById('postTitle').textContent = p.title;
document.getElementById('postMeta').textContent = `${p.date} · ${(p.tags||[]).join(', ')}`;
const content = document.getElementById('postContent');
content.innerHTML = p.html;
renderToc(content);
document.title = `${p.title} | 근영의 블로그`;
}


function router() {
const hash = decodeURIComponent(location.hash || '#/');
if (hash === '#/' || hash === '#') return renderList();
const [, slug] = hash.split('/');
renderPost(slug);
}
window.addEventListener('hashchange', router);
router();


searchInput.addEventListener('input', e => {
const q = e.target.value.trim().toLowerCase();
const filtered = posts.filter(p =>
p.title.toLowerCase().includes(q) || (p.tags||[]).join(' ').toLowerCase().includes(q)
);
renderList(filtered);
});


back.addEventListener('click', e => { e.preventDefault(); location.hash = '#/'; });


const themeBtn = document.getElementById('themeBtn');
const saved = localStorage.getItem('theme');
if (saved === 'dark') document.body.classList.add('dark');
if (saved === 'light') document.body.classList.remove('dark');


function toggleTheme(){
document.body.classList.toggle('dark');
localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}


themeBtn.addEventListener('click', () => {
toggleTheme();
themeBtn.setAttribute('aria-pressed', document.body.classList.contains('dark'));
});


document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
